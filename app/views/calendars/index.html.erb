<table class="table table-bordered table-cal">
  <thead>
    <tr>
      <th></th>
      <% rooms.each.with_index do |room, i| %>
        <th><%= "#{room.name} - #{i}" %></th>
      <% end %>
    </tr>
  </thead>

  <tbody>
    <% iterate_day(start_datetime, end_datetime, 30.minutes) do |half_hour_starts_at, half_hour_ends_at| %>
      <tr>
        <td class="td-time"><%= half_hour_starts_at.strftime('%H:%M') %></td>

        <% rooms.each.with_index do |room, i| %>
          <% resa = room.reservations.find { |reservation| reservation.in?(half_hour_starts_at, half_hour_ends_at) } %>
          <% if resa == nil %>
            <td><%= link_to "+", new_room_reservations_path({room_id: room.id}.merge(datetime_to_param(half_hour_starts_at))) %> </td>
          <% elsif !resa.rendered? %>
            <td class="td-reserved" rowspan="<%= resa.half_hours_used %>">
              <%= resa.name %>
              <%- resa.mark_as_rendered %>
            </td>
          <% else %>
          <% end %>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

